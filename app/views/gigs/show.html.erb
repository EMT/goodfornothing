<section id="primary_content">
	
	<h1><%= @gig.title %></h1>
	<% if @gig.start_time && @gig.end_time %>
	<time><%= @gig.start_time.to_formatted_s(:long_ordinal) %> - <%= @gig.end_time.to_formatted_s(:long_ordinal) %></time>
	<% end %>
	
	<% if @gig.chapter.users.any? %>
		<p>Organised by <%= @gig.chapter.users.crew.map { |u| link_to u.name, member_path(u) }.to_sentence.html_safe %></p>	
	<% else %>
		<p>Organised by the <%= @gig.chapter.title %> crew</p>
	<% end %>
	
	<%= markdown.render(@gig.description).html_safe %>
	
	<% if @gig.challenges.any? %>
	
		<h1>The challenge<%= "s" if @gig.challenges.length>1 %></h1>
		
		<% @gig.challenges.each do |challenge| %>
			<%= render :partial => "challenges/block", :locals => { :challenge => challenge } %>
		<% end %>
		
	<% end %>
	
</section>

<aside id="secondary_content">
	
	<% if @gig.start_time.past? && @gig.end_time.future? %>
		<p>This gig's happening right now, you can no longer register, but feel free to just drop in and say hello anyway!</p>
	<% elsif @gig.end_time.past? %>
		<p>This gig has ended but you can still get involved in its challenges.</p>
	<% else %>
		<% if user_signed_in? && current_user.is_attending_gig?(@gig) %>
			<h2>You're attending this gig</h2>
			<p>You've signed up for this gig, please let us know if you can no longer make it.</p>
			<p><%= link_to "Can no longer attend", attend_gig_path(@gig) %></p>
		<% elsif @gig.slots.count == 1 && @gig.slots.first.skill.nil? %>
			<p class="cta"><%= link_to "I'm Coming!", attend_gig_path(@gig, :slot => @gig.slots.first) %></p>
		<% elsif @gig.slots.any? %>
			<h2>Attend gig</h2>
			<table>
				<thead>
					<tr>
						<td>Skill</td>
						<td>Slots</td>
					</tr>
				</thead>
				<tbody>
					<% @gig.slots.each do |slot| %>
					<tr>
						<td><%= (slot.skill.present?) ? slot.skill.title : (slot.custom_skill.empty?) ? "Open to all" : slot.custom_skill %></td>
						<td><%= (slot.limit) ? slot.available_slots : "Unlimited" %></td>
						<% if slot.limit.nil? || slot.available_slots > 0 %>
						<td><%= link_to "Attend", attend_gig_path(@gig, :slot => slot) %></td>
						<% end %>
					</tr>
					<% end %>
				</tbody>
			</table>
		<% end %>
	
	<% end %>
	
	<% if @attendees.any? %>
		<h2>Who<%= (user_signed_in? && current_user.is_attending?(@gig) ? " else is" : "'s") %> coming?</h2>
		<ul>
			<% @attendees.each do |user| %>
				<%= render :partial => "members/avatar", :locals => { :member => user }%>
			<% end %>
		</ul>
	<% end %>
	
</aside>